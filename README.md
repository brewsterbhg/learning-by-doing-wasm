# WASM tutorial

This is a simple repo (just a basic Node server) for WASM LBD.

Also the second half of the LBD works uses Emscripten for LLVM-to-JavaScript compilation from C code. If you want to follow along, you'll need to install it. This requires a few dependencies:

## Prerequisites

1. `Git` (I hope you'll have this already)
2. `Python` (2.7 is most compatible). This should be installed by default on Mac, Windows doesnâ€™t need to worry because Emscripten comes bundled with Python. (check version with `python -V`)
3. `CMake` (if you participated in the OpenCV LBD, you will have installed this). This builds Emscripten itself. Mac users can download this through Homebrew. Windows can download a .msi file from cmake.org. (check with `cmake â€”version`).

The core Emscripten SDK is handled through a python script. Get it through the following steps:

### Install Emscripten

`brew install emscripten`

It has a hidden dependency if your MacOS version is "new", (https://embeddedartistry.com/blog/2017/2/20/installing-clangllvm-on-osx) so please run:

`brew install llvm`

### or Get the emsdk repo

Get the Emscripten SDK, using these instructions: https://kripken.github.io/emscripten-site/docs/getting_started/downloads.html

```
git clone https://github.com/emscripten-core/emsdk.git
cd emsdk
```

### Download and install the latest SDK tools.

`./emsdk install latest`

### Make the "latest" SDK "active" for the current user. (writes ~/.emscripten file)

`./emsdk activate latest`

### Activate PATH and other environment variables in the current terminal

`source ./emsdk_env.sh`

You can alternatively choose to add the env variables to your `PATH`.

**NOTE:** On Windows, run emsdk instead of `./emsdk`, and `emsdk_env.bat` instead of source `./emsdk_env.sh`.

You can confirm the installation is working by typing `emcc â€”version`

## How to get started

### Install dependecies

`npm run install` or `npm i` for short ðŸ˜Ž

### Start hacking

Run `npm start`

This will start an express server on port `2222` (why not ðŸ˜œ) serving any `.wasm` file as `'Content-Type', 'application/wasm'`.

## Gotchas

`Uncaught (in promise) CompileError: WebAssembly.compile(): expected magic word 00 61 73 6d, found 28 6d 6f 64 @+0`

From SF

In general, this error means that instead of the binary .wasm file your browser received something else. That can be a error page generated by the web server or the same .wasm but corrupted somehow. I recommend to open your browser Developer Tools, go to Network tab, Refresh the page and look at the .wasm resource request and response.

https://developer.mozilla.org/en-US/docs/WebAssembly/C_to_wasm
